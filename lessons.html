<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale1.0">
  <title>SoftFingers - Professional Typing Lessons</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="canonical" href="https://softfingers-typing.com/lessons.html">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --success-gradient: linear-gradient(135deg, #81ffef 0%, #f067b4 100%);
      
      --bg-primary: #0f1419;
      --bg-secondary: #1a1f2e;
      --bg-card: #242b3d;
      --bg-input: #2a3441;
      
      --text-primary: #ffffff;
      --text-secondary: #b8c5d6;
      --text-muted: #8a9ab0;
      
      --border-subtle: #374151;
      --border-accent: #4f46e5;
      
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.15);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.2);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Header Styles */
    .header {
      background: var(--primary-gradient);
      padding: 3rem 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="white" opacity="0.1"><path d="M0,50 Q250,0 500,50 T1000,50 L1000,100 L0,100 Z"/></svg>') no-repeat bottom;
      background-size: 100% 100px;
    }

    .header-content {
      position: relative;
      z-index: 1;
    }

    .header h1 {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .header .subtitle {
      font-size: 1.25rem;
      opacity: 0.9;
      font-weight: 400;
    }

    /* Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Card Styles */
    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-subtle);
      transition: var(--transition);
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    /* Tab Navigation */
    .tab-navigation {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      background: var(--bg-secondary);
      padding: 0.5rem;
      border-radius: var(--radius-md);
    }

    .tab {
      flex: 1;
      padding: 1rem 2rem;
      text-align: center;
      background: transparent;
      border: none;
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }

    .tab.active {
      background: var(--primary-gradient);
      color: var(--text-primary);
      box-shadow: var(--shadow-sm);
    }

    .tab:hover:not(.active) {
      background: var(--bg-input);
      color: var(--text-primary);
    }

    /* Progress Section */
    .progress-section {
      background: var(--bg-secondary);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      margin-bottom: 2rem;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .progress-text {
      font-weight: 600;
      color: var(--text-primary);
    }

    .progress-bar-container {
      height: 8px;
      background: var(--bg-input);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: var(--accent-gradient);
      transition: width 0.5s ease;
      width: 0%;
    }

    /* Lesson Area */
    .lesson-container {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .lesson-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--border-subtle);
    }

    .lesson-title {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .lesson-timestamp {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .passage {
      background: var(--bg-card);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 1.5rem;
      line-height: 1.3;
      margin-bottom: 1.5rem;
      border: 2px solid var(--border-subtle);
      max-height: 120px;
    }

    .typing-input {
      width: 100%;
      padding: 1.3rem;
      font-size: 1.3rem;
      background: var(--bg-input);
      border: 2px solid var(--border-subtle);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: 'Monaco', 'Consolas', monospace;
      transition: var(--transition);
    }

    .typing-input:focus {
      outline: none;
      border-color: var(--border-accent);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    /* Stats and Controls */
    .lesson-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 2rem;
    }

    .control-group {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--primary-gradient);
      color: var(--text-primary);
    }

    .btn-secondary {
      background: var(--bg-input);
      color: var(--text-secondary);
      border: 1px solid var(--border-subtle);
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .stat-card {
      background: var(--bg-input);
      padding: 1rem;
      border-radius: var(--radius-sm);
      text-align: center;
      border: 1px solid var(--border-subtle);
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    /* Keyboard Styles */
    .keyboard-section {
      margin: 3rem 0;
    }

    .keyboard-container {
      background: var(--bg-card);
      padding: 2rem;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
    }

    .keyboard {
      max-width: 800px;
      margin: 0 auto;
    }

    .keyboard-row {
      display: flex;
      justify-content: center;
      gap: 0.25rem;
      margin-bottom: 0.25rem;
    }

    .key {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      padding: 0.75rem;
      min-width: 2.5rem;
      height: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: inherit;
      font-size: 0.9rem;
      color: var(--text-secondary);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .key:hover {
      background: var(--bg-input);
    }

    .key.active {
      background: var(--accent-gradient);
      color: var(--text-primary);
      box-shadow: var(--shadow-sm);
    }

    .key.wide { min-width: 4rem; }
    .key.xwide { min-width: 6rem; }
    .key.xxwide { min-width: 8rem; }
    .key.space { min-width: 20rem; }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-muted);
    }

    /* Certificate Link */
    .certificate-section {
      text-align: center;
      margin: 3rem 0;
    }

    .cert-btn {
      background: var(--success-gradient);
      color: var(--text-primary);
      padding: 1rem 2rem;
      border-radius: var(--radius-md);
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: var(--transition);
    }

    .cert-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header {
        padding: 2rem 1rem;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .container {
        padding: 1rem;
      }
      
      .card {
        padding: 1.5rem;
      }
      
      .tab-navigation {
        flex-direction: column;
      }
      
      .lesson-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }
      
      .lesson-controls {
        grid-template-columns: 1fr;
      }
      
      .key.space {
        min-width: 10rem;
      }
    }

    /* Animation Classes */
    .fade-in {
      opacity: 0;
      animation: fadeIn 0.5s ease forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    .slide-up {
      transform: translateY(20px);
      opacity: 0;
      animation: slideUp 0.5s ease forwards;
    }

    @keyframes slideUp {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Exercise System Styles */
    .completed {
      border: 2px solid #4ade80 !important;
      background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(34, 197, 94, 0.1)) !important;
    }
    
    .locked {
      border: 2px solid #6b7280 !important;
      background: linear-gradient(135deg, rgba(107, 114, 128, 0.1), rgba(75, 85, 99, 0.1)) !important;
    }

    /* Hidden class */
    .hidden {
      display: none;
    }
 img {
  width: 100%;
  max-width: 500px;
  height: auto;
  aspect-ratio: 5 / 4;        /* consistent rectangle */
  object-fit: cover;
  border-radius: 20px;        /* rounded rectangle */
  display: block;
  margin: 0 auto;

  /* initial hidden state */
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.8s ease, transform 0.8s ease;
}

img.visible {
  opacity: 1;
  transform: translateY(0);
}

img:hover {
  transform: scale(1.05) translateY(-8px);
  box-shadow: 0 12px 25px rgba(0, 0, 0, 0.35);
}





  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h1>SoftFingers Professional Typing Lessons</h1>
      <div class="subtitle">Master touch typing with our comprehensive training program</div>
    </div>
  </div>

  <div class="container">
    <!-- Tab Navigation -->
    <div class="tab-navigation" id="lesson-tabs">
      <button class="tab active" data-level="beginner">Beginner</button>
      <button class="tab" data-level="intermediate">Intermediate</button>
      <button class="tab" data-level="advanced">Advanced</button>
    </div>

       <!-- Introduction Card -->
      <div class="card slide-up">
        <h2>Introduction to Touch Typing</h2>
        <p style="margin-bottom: 2rem; font-size: 1.1rem; color: var(--text-secondary);">
          <strong>Touch Typing</strong> is the ability to type without looking at the keyboard. This skill significantly improves your typing speed, accuracy, and reduces physical strain during extended typing sessions.
        </p>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
          <div>
            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Proper Sitting Position</h3>
            <ul style="color: var(--text-secondary); line-height: 1.8;">
              <li>Sit upright with your back straight and shoulders relaxed</li>
              <li>Keep feet flat on the floor with monitor at eye level</li>
              <li>Maintain slightly raised wrists without resting them on the keyboard</li>
              <li>Keep forearms parallel to the floor and take regular breaks</li>
              <img src="correcting-your-sitting-posture-1.jpg" alt="Sitting Posture" />
            </ul>
            
          </div>
          <div>
            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Hand Positioning</h3>
            <p style="color: var(--text-secondary); line-height: 1.8;">
              Position your hands on the <strong>Home Row</strong>: <strong>A S D F</strong> (left hand) and <strong>J K L ;</strong> (right hand). 
              Keep your thumbs on the <strong>Space</strong> bar and always return to the home row position after pressing each key.
              <img src="keybd_hand_position.jpg" alt="Hand Positioning" />
            </p>
          </div>
        </div>

        <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: var(--radius-md);">
          <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Understanding Typing Metrics</h3>
          <p style="color: var(--text-secondary); line-height: 1.8;">
            <strong>WPM (Words Per Minute)</strong>: Standard measurement where 1 word equals approximately 5 characters.<br>
            <strong>Accuracy</strong>: Percentage of correctly typed characters out of total characters typed.<br>
            <strong>AWPM (Adjusted WPM)</strong>: WPM multiplied by accuracy percentage for a more realistic speed measurement.
          </p>
        </div>
      </div>

      <!-- Lesson Requirements -->
      <div class="card slide-up">
        <h2>Lesson Requirements</h2>
        <div style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);; color: white; padding: 1.5rem; border-radius: var(--radius-md); text-align: center; font-weight: 600;">
          Pass Requirement: ‚â• 30 WPM and ‚â• 90% Accuracy | 30 exercises per lesson
        </div>
      </div>

      <!-- Active Lesson Area -->
      <div class="lesson-container slide-up">
        <div class="lesson-header" id="lesson-header">
          <div>
            <h2 class="lesson-title" id="lesson-title">Select a lesson to begin</h2>
            <div class="lesson-timestamp" id="lesson-timestamp"></div>
          </div>
        </div>
               
      
<!-- Virtual Keyboard -->
      <div class="keyboard-section slide-up">
          <div class="lesson-controls">
          <div class="control-group">
            <button class="btn btn-secondary" id="prev-btn">‚Üê Previous</button>
            <button class="btn btn-secondary" id="next-btn">Next ‚Üí</button>
            <button class="btn btn-primary" id="retry-btn">üîÑ Retry</button>
          </div>

          <div class="stat-card">
            <div class="stat-label">Timer</div>
            <div class="stat-value" id="timer">120s</div>
          </div>

          <div class="stat-card">
            <div class="stat-label">WPM</div>
            <div class="stat-value" id="stat-wpm">0</div>
          </div>

          <div class="stat-card">
            <div class="stat-label">Accuracy</div>
            <div class="stat-value" id="stat-acc">100%</div>
          </div>
          
        </div>
      </div>
      
        <div class="card">
          <h2 style="text-align: center; margin-bottom: 2rem;">Live Keyboard Guide</h2>
           <div class="passage" id="passage">
          Welcome to SoftFingers Professional Typing Lessons. Select a lesson from the grid below to start your typing journey with 30 exercises per lesson.
        </div>
        
          <input 
          id="typing-input" 
          type="text" 
          class="typing-input" 
          placeholder="Start typing here when lesson begins‚Ä¶" 
          autocomplete="off" 
          spellcheck="false"
        />
          <div class="keyboard-container">
            <div class="keyboard">
              <!-- Row 1 -->
              <div class="keyboard-row">
                <div class="key wide" data-code="Backquote">` ~</div>
                <div class="key" data-code="Digit1">1 !</div>
                <div class="key" data-code="Digit2">2 @</div>
                <div class="key" data-code="Digit3">3 #</div>
                <div class="key" data-code="Digit4">4 $</div>
                <div class="key" data-code="Digit5">5 %</div>
                <div class="key" data-code="Digit6">6 ^</div>
                <div class="key" data-code="Digit7">7 &</div>
                <div class="key" data-code="Digit8">8 *</div>
                <div class="key" data-code="Digit9">9 (</div>
                <div class="key" data-code="Digit0">0 )</div>
                <div class="key" data-code="Minus">- _</div>
                <div class="key" data-code="Equal">= +</div>
                <div class="key xwide" data-code="Backspace">Backspace</div>
              </div>
              
              <!-- Row 2 -->
              <div class="keyboard-row">
                <div class="key wide" data-code="Tab">Tab</div>
                <div class="key" data-code="KeyQ">Q</div>
                <div class="key" data-code="KeyW">W</div>
                <div class="key" data-code="KeyE">E</div>
                <div class="key" data-code="KeyR">R</div>
                <div class="key" data-code="KeyT">T</div>
                <div class="key" data-code="KeyY">Y</div>
                <div class="key" data-code="KeyU">U</div>
                <div class="key" data-code="KeyI">I</div>
                <div class="key" data-code="KeyO">O</div>
                <div class="key" data-code="KeyP">P</div>
                <div class="key" data-code="BracketLeft">[ {</div>
                <div class="key" data-code="BracketRight">] }</div>
                <div class="key" data-code="Backslash">\ |</div>
              </div>
              
              <!-- Row 3 -->
              <div class="keyboard-row">
                <div class="key wide" data-code="CapsLock">Caps Lock</div>
                <div class="key" data-code="KeyA">A</div>
                <div class="key" data-code="KeyS">S</div>
                <div class="key" data-code="KeyD">D</div>
                <div class="key" data-code="KeyF">F</div>
                <div class="key" data-code="KeyG">G</div>
                <div class="key" data-code="KeyH">H</div>
                <div class="key" data-code="KeyJ">J</div>
                <div class="key" data-code="KeyK">K</div>
                <div class="key" data-code="KeyL">L</div>
                <div class="key" data-code="Semicolon">; :</div>
                <div class="key" data-code="Quote">' "</div>
                <div class="key xwide" data-code="Enter">Enter</div>
              </div>
              
              <!-- Row 4 -->
              <div class="keyboard-row">
                <div class="key xxwide" data-code="ShiftLeft">Shift</div>
                <div class="key" data-code="KeyZ">Z</div>
                <div class="key" data-code="KeyX">X</div>
                <div class="key" data-code="KeyC">C</div>
                <div class="key" data-code="KeyV">V</div>
                <div class="key" data-code="KeyB">B</div>
                <div class="key" data-code="KeyN">N</div>
                <div class="key" data-code="KeyM">M</div>
                <div class="key" data-code="Comma">, <</div>
                <div class="key" data-code="Period">. ></div>
                <div class="key" data-code="Slash">/ ?</div>
                <div class="key xxwide" data-code="ShiftRight">Shift</div>
              </div>
              
              <!-- Row 5 -->
              <div class="keyboard-row">
                <div class="key wide" data-code="ControlLeft">Ctrl</div>
                <div class="key wide" data-code="MetaLeft">Win</div>
                <div class="key wide" data-code="AltLeft">Alt</div>
                <div class="key space" data-code="Space">Space</div>
                <div class="key wide" data-code="AltRight">Alt</div>
                <div class="key wide" data-code="MetaRight">Win</div>
                <div class="key wide" data-code="ContextMenu">Menu</div>
                <div class="key wide" data-code="ControlRight">Ctrl</div>
              </div>
             </div>
          </div>
        </div>
      </div>
      <!-- Beginner Section -->
    <div class="section fade-in" id="section-beginner">
      <!-- Progress Section -->
      <div class="progress-section">
        <div class="progress-header">
          <span class="progress-text" id="progress-text">Progress: 0 / 12 lessons | 0 / 300 exercises</span>
          <button class="btn btn-secondary" id="progress-btn">üìä View History</button>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
      </div>

             
      <!-- Lessons Grid -->
      <div class="card slide-up">
        <h2>Lesson Selection</h2>
        <div id="lessons-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; margin-top: 1rem;">
          <!-- Lessons will be populated by JavaScript -->
        </div>
      </div>

      <!-- Certificate Section -->
      <div class="certificate-section">
        <a href="certificate.html" class="cert-btn">
          üéì View Beginner Certificate
        </a>
      </div>
    </div>

    <!-- Intermediate Section -->
    <div class="section hidden" id="section-intermediate">
      <div class="card">
        <div style="text-align: center; padding: 3rem;">
          <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">üîí</div>
          <h2>Intermediate Lessons</h2>
          <p style="color: var(--text-muted); font-size: 1.1rem;">
            Complete all Beginner lessons with ‚â• 30 WPM & ‚â• 90% accuracy to unlock Intermediate level.
          </p>
        </div>
      </div>
    </div>

    <!-- Advanced Section -->
    <div class="section hidden" id="section-advanced">
      <div class="card">
        <div style="text-align: center; padding: 3rem;">
          <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">üîí</div>
          <h2>Advanced Lessons</h2>
          <p style="color: var(--text-muted); font-size: 1.1rem;">
            Complete all Intermediate lessons to unlock Advanced level training.
          </p>
        </div>
      </div>
    </div>

    <!-- Back Button -->
    <div class="card">
      <button class="btn btn-secondary" onclick="window.location.href='main.html'">
        ‚Üê Back to Dashboard
      </button>
    </div>
  </div>

  <!-- Progress Modal -->
  <div id="progress-modal" class="modal">
    <div class="modal-content">
      <span class="close" id="close-progress">&times;</span>
      <h2>üìä Progress History</h2>
      <div class="progress-bar-container" style="margin: 1rem 0;">
        <div class="progress-bar" style="width: 0%;"></div>
      </div>
      <p id="progress-details">Track your learning progress and see detailed statistics for each completed lesson.</p>
      <div id="progress-list">
        <!-- Progress history will be populated here -->
      </div>
    </div>
  </div>

  <script>
    // Global state
    let currentLessonIndex = 0;
    let currentExerciseIndex = 0;
    let startTime = null;
    let timerInterval = null;
    let timeLeft = 120;
    let isTyping = false;

    // Enhanced lessons data
    const enhancedLessons = [
      // Lesson 1: Home Row Fundamentals (30 exercises)
      {
       id:1,
        name: 'Home Row Fundamentals',
        category: 'home-row',
        target_wpm: 20,
        description: 'Master the foundation keys of the Left Hand  A S D F',
        exercises:[
          'a s d f',
's d f a',
'd f a s',
'f a s d',
'a s a s',
'a s d a',
'a s d f',
'a s a f',
'a s d f a',
'a d f a s',
'a f s a s',
'a f d a f',
's a s d',
'd a f s',
'f s a d',
'd f d a',
's a f d',
'f d s a',
'a d s f',
's f a s',
'd a s f',
'f s d a',
'a f d s',
's a d f',
'd s f a',
'f a d s',
'a d a f',
's f s a',
'd f d s',
'f s f a',
]},
        {id:2,
        name: 'Home Row Fundamentals',
        category: 'home-row',
        target_wpm: 20,
        description: 'Master the foundation keys of the Right Hand  J K L ;',
        exercises:[
          'j k l ;',
'k l ; j',
'l ; j k',
'; j k l',
'j k j k',
'j k l j',
'j k l ;',
'j k j ;',
'j k l ; j',
'j l ; j k',
'j ; k j k',
'j ; l j ;',
'k j k l',
'l j ; k',
'; k j l',
'l ; l j',
'k j ; l',
'; l k j',
'j l k ;',
'k ; j k',
'l j k ;',
'; k l j',
'j ; l k',
'k j l ;',
'l k ; j',
'; j l k',
'j l j ;',
'k ; k j',
'l ; l k',
'; k ; j',
]},
        {id: 3,
        name: 'Home Row Fundamentals',
        category: 'home-row',
        target_wpm: 25,
        description: 'Master the foundation keys A S D F J K L ;',
        exercises: [
          'asdf jkl; asdf jkl; asdf jkl;',
          'fff jjj fff jjj fff jjj fff jjj',
          'ddd kkk ddd kkk ddd kkk ddd kkk',
          'sss lll sss lll sss lll sss lll',
          'aaa ;;; aaa ;;; aaa ;;; aaa ;;;',
          'fd jk fd jk fd jk fd jk fd jk',
          'sa l; sa l; sa l; sa l; sa l;',
          'af jk af jk af jk af jk af jk',
          'ds kl ds kl ds kl ds kl ds kl',
          'ask ask ask ask ask ask ask',
          'lad lad lad lad lad lad lad',
          'sad sad sad sad sad sad sad',
          'fall fall fall fall fall fall',
          'ask a lad; ask a lad; ask a lad;',
          'a sad dad; a sad dad; a sad dad;',
          'fall ask fall ask fall ask',
          'lads ask lads; lads ask lads;',
          'a flask; a flask; a flask;',
          'dad has a flask; dad has a flask;',
          'sad lads fall; sad lads fall;',
          'ask dad; fall lads; ask dad;',
          'a lass has a flask; a lass has',
          'falls ask lads; falls ask lads;',
          'flash flash flash flash flash',
          'slash slash slash slash slash',
          'dads ask; lads fall; dads ask;',
          'a sad lass asks dad; asks dad;',
          'fall; ask; sad; lads; flask;',
          'dad asks a sad lass; sad lass;',
          'ask lads; fall flask; sad dads;'
        ]
      },
      {
        id: 4,
        name: 'Home Row Mastery',
        category: 'home-row',
        target_wpm: 28,
        description: 'Advanced home row combinations and words',
        exercises: [
          'glass glass glass glass glass',
          'class class class class class',
          'shall shall shall shall shall',
          'lass lass lass lass lass lass',
          'flask flask flask flask flask',
          'slash slash slash slash slash',
          'flash flash flash flash flash',
          'ask a class; ask a class;',
          'a glass flask; a glass flask;',
          'shall ask; shall fall; shall;',
          'dad has a glass; has a glass;',
          'a lass asks; a lass asks;',
          'flash; slash; glass; class;',
          'lads shall ask; lads shall ask;',
          'a sad class falls; class falls;',
          'ask dads; slash glass; ask dads;',
          'shall flash; shall slash; shall;',
          'a flask has glass; has glass;',
          'sad lass asks dad; asks dad;',
          'fall flash; ask glass; fall;',
          'dads shall ask a lass; ask lass;',
          'glass flask falls; flask falls;',
          'ask; fall; flash; slash; glass;',
          'a class shall ask; shall ask;',
          'sad dads fall; lads flash; fall;',
          'flask glass; slash ask; glass;',
          'shall a lass ask dad? ask dad?',
          'flash glass slash; glass slash;',
          'ask class; fall flask; sad glass;',
          'a glass flask shall fall; shall;'
        ]
      },
      {
        id: 5,
        name: 'Upper Row Q W E R',
        category: 'upper-row',
        target_wpm: 26,
        description: 'Learn Q W E R keys with home row',
        exercises: [
          'qqq www eee rrr qqq www eee rrr',
          'qwe qwe qwe qwe qwe qwe qwe qwe',
          'req req req req req req req req',
          'wer wer wer wer wer wer wer wer',
          'qwer qwer qwer qwer qwer qwer',
          'were were were were were were',
          'wear wear wear wear wear wear',
          'dear dear dear dear dear dear',
          'read read read read read read',
          'real real real real real real',
          'dale dale dale dale dale dale',
          'ware ware ware ware ware ware',
          'earl earl earl earl earl earl',
          'rade rade rade rade rade rade',
          'we are; we are; we are; we are;',
          'read a dear; read a dear; read;',
          'wear real; wear real; wear real;',
          'a dear earl; a dear earl; earl;',
          'we read; we wear; we read; read;',
          'earl reads; earl reads; earl;',
          'dear dale wears; dale wears;',
          'we are real; we are real; real;',
          'a dear reads; a dear reads;',
          'wear red; read dear; wear red;',
          'earl wears; dale reads; earl;',
          'we read a dear earl; dear earl;',
          'real ware; dear read; real ware;',
          'a red earl reads; earl reads;',
          'dear dale; real earl; dear dale;',
          'we wear real red; wear real red;'
        ]
      },
      {
        id: 6,
        name: 'Upper Row T Y U I O P',
        category: 'upper-row',
        target_wpm: 30,
        description: 'Complete upper row key mastery',
        exercises: [
          'ttt yyy uuu iii ooo ppp ttt yyy',
          'tyu tyu tyu tyu tyu tyu tyu tyu',
          'iop iop iop iop iop iop iop iop',
          'tyui tyui tyui tyui tyui tyui',
          'yiop yiop yiop yiop yiop yiop',
          'quit quit quit quit quit quit',
          'your your your your your your',
          'port port port port port port',
          'type type type type type type',
          'troy troy troy troy troy troy',
          'pity pity pity pity pity pity',
          'pour pour pour pour pour pour',
          'tour tour tour tour tour tour',
          'riot riot riot riot riot riot',
          'port your; port your; port your;',
          'type a quit; type a quit; type;',
          'your port; tour pity; your port;',
          'pour troy; riot port; pour troy;',
          'quit your tour; quit your tour;',
          'type port; your riot; type port;',
          'troy pours; pity quits; troy;',
          'your tour port; your tour port;',
          'riot type; pour quit; riot type;',
          'port pity troy; port pity troy;',
          'quit your riot; quit your riot;',
          'type tour pours; type tour pours;',
          'your pity port; your pity port;',
          'riot quits; troy tours; riot;',
          'pour type; quit tour; pour type;',
          'your troy port quits; port quits;'
        ]
      },
      {
        id: 7,
        name: 'Bottom Row Z X C V',
        category: 'bottom-row',
        target_wpm: 24,
        description: 'Learn Z X C V keys',
        exercises: [
          'zzz xxx ccc vvv zzz xxx ccc vvv',
          'zxc zxc zxc zxc zxc zxc zxc zxc',
          'xcv xcv xcv xcv xcv xcv xcv xcv',
          'zxcv zxcv zxcv zxcv zxcv zxcv',
          'cave cave cave cave cave cave',
          'coax coax coax coax coax coax',
          'vex vex vex vex vex vex vex vex',
          'czar czar czar czar czar czar',
          'zeal zeal zeal zeal zeal zeal',
          'zero zero zero zero zero zero',
          'axis axis axis axis axis axis',
          'civic civic civic civic civic',
          'voice voice voice voice voice',
          'crave crave crave crave crave',
          'cave zero; cave zero; cave zero;',
          'vex czar; coax voice; vex czar;',
          'zero axis; cave civic; zero axis;',
          'crave zeal; voice coax; crave;',
          'czar caves; zero voices; czar;',
          'vex civic; coax cave; vex civic;',
          'zero craves; axis voices; zero;',
          'cave czar; vex zeal; cave czar;',
          'civic voice; coax zero; civic;',
          'crave axis; cave vex; crave axis;',
          'zero civic czar; zero civic czar;',
          'vex voice; coax crave; vex voice;',
          'cave axis; czar zero; cave axis;',
          'civic craves; voice coax; civic;',
          'zero vex; cave voice; zero vex;',
          'czar civic cave; czar civic cave;'
        ]
      },
      {
        id: 8,
        name: 'Bottom Row B N M',
        category: 'bottom-row',
        target_wpm: 28,
        description: 'Complete bottom row with B N M',
        exercises: [
          'bbb nnn mmm bbb nnn mmm bbb nnn',
          'bnm bnm bnm bnm bnm bnm bnm bnm',
          'mnb mnb mnb mnb mnb mnb mnb mnb',
          'been been been been been been',
          'name name name name name name',
          'come come come come come come',
          'beam beam beam beam beam beam',
          'moon moon moon moon moon moon',
          'bone bone bone bone bone bone',
          'mean mean mean mean mean mean',
          'boom boom boom boom boom boom',
          'room room room room room room',
          'main main main main main main',
          'norm norm norm norm norm norm',
          'been name; been name; been name;',
          'come beam; moon bone; come beam;',
          'mean boom; room main; mean boom;',
          'norm comes; beam moons; norm;',
          'name been; bone mean; name been;',
          'come room; main boom; come room;',
          'moon beam; norm name; moon beam;',
          'been main; come norm; been main;',
          'boom room; bone beam; boom room;',
          'name moon; mean come; name moon;',
          'norm been boom; norm been boom;',
          'come main beam; come main beam;',
          'moon room; bone name; moon room;',
          'been boom; mean norm; been boom;',
          'come bone; name beam; come bone;',
          'main moon norm; main moon norm;'
        ]
      },
      {
        id: 9,
        name: 'Three Row Integration',
        category: 'combined',
        target_wpm: 32,
        description: 'Combine all keyboard rows',
        exercises: [
          'quick brown fox; quick brown fox;',
          'jumps over lazy; jumps over lazy;',
          'the dog runs; the dog runs; runs;',
          'brown fox jumps; brown fox jumps;',
          'quick lazy dog; quick lazy dog;',
          'over the brown; over the brown;',
          'fox runs quick; fox runs quick;',
          'lazy dog jumps; lazy dog jumps;',
          'the quick fox; the quick fox;',
          'brown dog over; brown dog over;',
          'jumps lazy fox; jumps lazy fox;',
          'quick brown runs; quick brown runs;',
          'the fox over; the fox over; over;',
          'lazy jumps dog; lazy jumps dog;',
          'brown quick fox; brown quick fox;',
          'the dog jumps over; dog jumps over;',
          'quick brown lazy fox; brown lazy;',
          'over the quick dog; the quick dog;',
          'fox jumps brown; fox jumps brown;',
          'lazy the over; lazy the over;',
          'quick dog brown fox; dog brown fox;',
          'jumps over the lazy; over the lazy;',
          'brown fox quick dog; fox quick dog;',
          'the lazy jumps; the lazy jumps;',
          'over quick brown; over quick brown;',
          'fox dog lazy; fox dog lazy; lazy;',
          'the quick brown fox jumps; fox jumps;',
          'over the lazy dog; over lazy dog;',
          'brown quick fox; brown quick fox;',
          'jumps lazy over the; lazy over the;'
        ]
      },
      {
        id: 10,
        name: 'Numbers 1-5',
        category: 'numbers',
        target_wpm: 28,
        description: 'Learn numbers 1 2 3 4 5',
        exercises: [
          '111 222 333 444 555 111 222 333',
          '12345 12345 12345 12345 12345',
          '54321 54321 54321 54321 54321',
          '1234 1234 1234 1234 1234 1234',
          '5432 5432 5432 5432 5432 5432',
          '123 321 123 321 123 321 123 321',
          '45 54 45 54 45 54 45 54 45 54',
          '135 531 135 531 135 531 135 531',
          '24 42 24 42 24 42 24 42 24 42',
          '1 cat 2 dogs 3 birds 4 fish 5 mice',
          '5 apples 4 oranges 3 bananas today',
          '12 hours 34 minutes 5 seconds left',
          'room 123 has 45 chairs and 5 tables',
          'call 555-1234 for 3 quick answers',
          'buy 2 books 4 pens and 1 notebook',
          'drive 15 miles in 23 minutes today',
          'score 12 points in 34 seconds flat',
          '5 teams 4 games 3 wins 2 losses 1 tie',
          'page 123 line 45 word 1 letter 2',
          'add 12 plus 34 equals 46 total sum',
          '1st place 2nd runner 3rd position',
          '4 cups 5 spoons 3 plates 2 bowls 1 pot',
          'meet at 12:34 in room 15 today',
          '25 students 13 teachers 4 classes',
          '1 dog 2 cats 3 birds 4 fish 5 mice play',
          'dial 123-4567 extension 15 quickly',
          '54 degrees 32 minutes 1 second north',
          '123 main street apartment 45 today',
          '1 plus 2 plus 3 plus 4 equals 10',
          '5 minutes 4 hours 3 days 2 weeks 1 month'
        ]
      },
      {
        id: 11,
        name: 'Numbers 6-0',
        category: 'numbers',
        target_wpm: 30,
        description: 'Complete number row 6 7 8 9 0',
        exercises: [
          '666 777 888 999 000 666 777 888',
          '67890 67890 67890 67890 67890',
          '09876 09876 09876 09876 09876',
          '6789 6789 6789 6789 6789 6789',
          '0987 0987 0987 0987 0987 0987',
          '678 876 678 876 678 876 678 876',
          '90 09 90 09 90 09 90 09 90 09',
          '679 976 679 976 679 976 679 976',
          '80 08 80 08 80 08 80 08 80 08',
          '6 cars 7 bikes 8 trucks 9 vans 0 boats',
          '70 degrees 89 humidity 6 wind speed',
          '678 west avenue apartment 90 today',
          'call 890-6789 between 6 and 7 pm',
          'buy 6 apples 7 oranges 8 bananas 9 pears',
          'score 67 to 89 in 90 minutes total',
          'drive 678 miles in 90 hours exactly',
          '8 teams 9 games 7 wins 6 losses 0 ties',
          'page 678 line 90 word 6 letter 7',
          '60 plus 78 plus 9 equals 147 total',
          '6th grade 7th period 8th chapter 9th page',
          '9 cups 8 spoons 7 plates 6 bowls 0 pots',
          'meet at 6:78 wait that is 6:30 today',
          '89 students 67 teachers 0 substitutes',
          '6 dogs 7 cats 8 birds 9 fish 0 mice run',
          'dial 678-9012 extension 60 quickly now',
          '89 degrees 67 minutes 0 seconds south',
          '6789 oak street apartment 0 today only',
          '6 plus 7 plus 8 plus 9 equals 30 sum',
          '90 minutes 8 hours 7 days 6 weeks 0 months',
          '1234567890 all numbers typed correctly now'
        ]
      },
      {
        id: 12,
        name: 'Basic Punctuation',
        category: 'punctuation',
        target_wpm: 32,
        description: 'Master . , ? ! ; : " \'',
        exercises: [
          '... ,,, ??? !!! ;;; ::: """ \'\'\'',
          'hello, world. how are you today?',
          'i am fine, thank you very much!',
          'what time is it? it is 3:30 pm.',
          'she said, "hello there, friend."',
          'don\'t worry; everything will be okay.',
          'yes, i can help you with that task.',
          'where are you going? i\'m going home.',
          'stop! look both ways before crossing.',
          'the cat, dog, and bird are playing.',
          '"are you ready?" she asked quickly.',
          'no, i can\'t go; i have work today.',
          'wow! that\'s amazing news to hear.',
          'please, sit down and make yourself comfortable.',
          'what\'s your name? my name is john.',
          'i love pizza, pasta, and ice cream.',
          '"hello," he said. "how are you?"',
          'stop, look, listen; then cross safely.',
          'yes! we won the game by five points.',
          'she can\'t come; she\'s busy working.',
          'what time? when? where? why ask now?',
          'i said, "please wait for me here."',
          'don\'t run; walk carefully and slowly.',
          'great! that\'s exactly what we needed.',
          'the book, pen, and paper are ready.',
          '"good morning," she said with a smile.',
          'i won\'t go; it\'s too late tonight.',
          'help! someone call for assistance now!',
          'he asked, "can you help me, please?"',
          'wait; let me think about this carefully.'
        ]
      }
    ];

    // Progress data stored in localStorage
    let progressData = JSON.parse(localStorage.getItem('typingProgress')) || {
      completedLessons: [],
      bestScores: {},
      totalTime: 0,
      streak: 0,
      exerciseProgress: {},
      unlockedLessons: [1]
    };

    // DOM references
    const lessonsGrid = document.getElementById('lessons-grid');
    const keys = document.querySelectorAll('.key');
    const typingInput = document.getElementById('typing-input');
    const passageEl = document.getElementById('passage');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const retryBtn = document.getElementById('retry-btn');
    const progressBtn = document.getElementById('progress-btn');
    const progressModal = document.getElementById('progress-modal');
    const closeProgress = document.getElementById('close-progress');

    // Utility: get lesson index from lesson id
    function lessonIndexById(id) {
      return enhancedLessons.findIndex(l => l.id === id);
    }

    // Populate lesson cards grid
    function populateLessonsGrid() {
      lessonsGrid.innerHTML = '';

      const categories = {
        'home-row': { name: 'Home Row Left-Hand', lessons: [] },
        'home-row': { name: 'Home Row Right-Hand', lessons: [] },
        'home-row': { name: 'Home Row Mastery', lessons: [] },
        'upper-row': { name: 'Upper Row Left-Hand', lessons: [] },
        'upper-row': { name: 'Upper Row Right-Hand', lessons: [] },
        'upper-row': { name: 'Upper Row Training', lessons: [] },
        'bottom-row': { name: 'Bottom Row Left-Hand', lessons: [] },
        'bottom-row': { name: 'Bottom Row Right-Hand', lessons: [] },
        'bottom-row': { name: 'Bottom Row Practice', lessons: [] },
        'combined': { name: 'Multi-Row Combinations', lessons: [] },
        'numbers': { name: 'Numbers & Digits', lessons: [] },
        'punctuation': { name: 'Punctuation & Symbols', lessons: [] }
      };

      enhancedLessons.forEach(lesson => {
        if (categories[lesson.category]) categories[lesson.category].lessons.push(lesson);
      });

      Object.keys(categories).forEach(catKey => {
        const cat = categories[catKey];
        if (!cat.lessons.length) return;

        // Category header
        const catHeader = document.createElement('div');
        catHeader.style.cssText = `
          grid-column: 1 / -1;
          margin: 2rem 0 1rem 0;
          padding: 1rem;
          background: var(--primary-gradient);
          border-radius: var(--radius-md);
          text-align: center;
          font-weight: 600;
          font-size: 1.1rem;
        `;
        catHeader.innerHTML = `
          <div>${cat.name}</div>
          <div style="font-size: 0.8rem; opacity: 0.9; margin-top: 0.5rem;">
            ${cat.lessons.length} lesson${cat.lessons.length > 1 ? 's' : ''} ‚Ä¢ 30 exercises each
          </div>
        `;
        lessonsGrid.appendChild(catHeader);

        // Lessons
        cat.lessons.forEach(lesson => {
          const lessonCard = document.createElement('div');
          const isCompleted = progressData.completedLessons.includes(lesson.id);
          const exerciseProg = progressData.exerciseProgress[lesson.id] || [];
          const completedExercises = exerciseProg.length;
          const bestScore = progressData.bestScores[lesson.id];

          const isLocked = !progressData.unlockedLessons.includes(lesson.id);

          lessonCard.className = `stat-card ${isCompleted ? 'completed' : ''} ${isLocked ? 'locked' : ''}`;
          lessonCard.style.cursor = isLocked ? 'not-allowed' : 'pointer';
          lessonCard.style.opacity = isLocked ? '0.5' : '1';

          const categoryColors = {
            'home-row': '#4ade80',
            'upper-row': '#3b82f6', 
            'bottom-row': '#f59e0b',
            'combined': '#8b5cf6',
            'numbers': '#ef4444',
            'punctuation': '#10b981'
          };

          lessonCard.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
              <div class="stat-label">Lesson ${lesson.id}</div>
              <div style="width: 12px; height: 12px; border-radius: 50%; background: ${categoryColors[lesson.category] || '#6b7280'};"></div>
            </div>
            <div class="stat-value" style="font-size: 0.9rem; margin-bottom: 0.5rem;">
              ${lesson.name}
              ${isLocked ? ' üîí' : ''}
            </div>
            <div style="font-size: 0.7rem; color: var(--text-muted); line-height: 1.4;">
              ${lesson.description}
            </div>
            <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.5rem;">
              Target: ${lesson.target_wpm} WPM ‚Ä¢ ${lesson.exercises.length} exercises
            </div>
            <div style="margin-top: 0.5rem;">
              <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 0.3rem;">
                Progress: ${completedExercises}/${lesson.exercises.length}
              </div>
              <div style="width: 100%; height: 4px; background: var(--bg-input); border-radius: 2px; overflow: hidden;">
                <div style="height: 100%; background: ${categoryColors[lesson.category]}; width: ${(completedExercises / lesson.exercises.length) * 100}%; transition: width 0.3s ease;"></div>
              </div>
            </div>
            ${bestScore ? `
              <div style="font-size: 0.7rem; color: ${categoryColors[lesson.category]}; margin-top: 0.5rem;">
                Best: ${bestScore.wpm} WPM (${bestScore.accuracy}%)
              </div>
            ` : ''}
            ${isCompleted ? `
              <div style="font-size: 0.8rem; color: #4ade80; margin-top: 0.5rem;">
                ‚úì All Exercises Completed
              </div>
            ` : isLocked ? `
              <div style="font-size: 0.7rem; color: #ef4444; margin-top: 0.5rem;">
                Complete previous lessons to unlock
              </div>
            ` : completedExercises > 0 ? `
              <div style="font-size: 0.7rem; color: #f59e0b; margin-top: 0.5rem;">
                üìö In Progress
              </div>
            ` : ''}
          `;

          lessonCard.addEventListener('click', () => {
            if (isLocked) {
              alert(`Please complete previous lessons to unlock this lesson.`);
            } else {
              loadLesson(lessonIndexById(lesson.id));
            }
          });

          lessonsGrid.appendChild(lessonCard);
        });
      });
    }

    // Update overall progress display
    function updateProgressDisplay() {
      const completed = progressData.completedLessons.length;
      const total = enhancedLessons.length;

      let totalExercisesCompleted = 0;
      let totalExercises = 0;

      enhancedLessons.forEach(lesson => {
        totalExercises += lesson.exercises.length;
        const exProg = progressData.exerciseProgress[lesson.id] || [];
        totalExercisesCompleted += exProg.length;
      });

      const progressText = document.getElementById('progress-text');
      if (progressText) {
        progressText.textContent = `Progress: ${completed}/${total} lessons | ${totalExercisesCompleted}/${totalExercises} exercises`;
      }

      const progressBar = document.getElementById('progress-bar');
      if (progressBar) {
        const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
        progressBar.style.width = percentage + '%';
      }
    }

    // Progress modal population
    function updateProgressModal() {
      const progressList = document.getElementById('progress-list');
      progressList.innerHTML = '';

      enhancedLessons.forEach(lesson => {
        const isCompleted = progressData.completedLessons.includes(lesson.id);
        const exerciseProgress = progressData.exerciseProgress[lesson.id] || [];
        const completedExercises = exerciseProgress.length;
        const bestScore = progressData.bestScores[lesson.id];

        const listItem = document.createElement('div');
        listItem.style.cssText = `
          padding: 1rem;
          margin: 0.5rem 0;
          background: var(--bg-secondary);
          border-radius: 8px;
          border-left: 4px solid ${isCompleted ? '#4ade80' : completedExercises > 0 ? '#f59e0b' : '#6b7280'};
        `;

        listItem.innerHTML = `
          <div style="font-weight: 600; margin-bottom: 0.5rem;">${lesson.name}</div>
          <div style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.5rem;">${lesson.description}</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary);">
            Progress: ${completedExercises}/${lesson.exercises.length} exercises completed
          </div>
          <div style="width: 100%; height: 6px; background: var(--bg-input); border-radius: 3px; margin: 0.5rem 0;">
            <div style="height: 100%; background: ${isCompleted ? '#4ade80' : '#f59e0b'}; width: ${(completedExercises / lesson.exercises.length) * 100}%; border-radius: 3px; transition: width 0.3s ease;"></div>
          </div>
          ${bestScore ? 
            `<div style="margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-secondary);">
              Best Score: ${bestScore.wpm} WPM, ${bestScore.accuracy}% accuracy
            </div>` : 
            '<div style="margin-top: 0.5rem; font-size: 0.8rem; color: #ef4444;">Not started</div>'
          }
        `;
        progressList.appendChild(listItem);
      });

      const totalExercises = enhancedLessons.reduce((sum, l) => sum + l.exercises.length, 0);
      const completedExercises = Object.values(progressData.exerciseProgress).reduce((sum, arr) => sum + arr.length, 0);

      document.getElementById('progress-details').innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 1rem 0;">
          <div style="text-align: center; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: 700;">${progressData.completedLessons.length}</div>
            <div style="font-size: 0.8rem; color: var(--text-muted);">Lessons Completed</div>
          </div>
          <div style="text-align: center; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: 700;">${completedExercises}</div>
            <div style="font-size: 0.8rem; color: var(--text-muted);">Exercises Completed</div>
          </div>
          <div style="text-align: center; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: 700;">${Math.round(progressData.totalTime / 60)}</div>
            <div style="font-size: 0.8rem; color: var(--text-muted);">Minutes Practiced</div>
          </div>
          <div style="text-align: center; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: 700;">${progressData.streak}</div>
            <div style="font-size: 0.8rem; color: var(--text-muted);">Current Streak</div>
          </div>
        </div>
      `;
    }

    // Keyboard highlight
    function highlightKey(keyCode) {
      keys.forEach(key => key.classList.remove('active'));
      const targetKey = document.querySelector(`[data-code="${keyCode}"]`);
      if (targetKey) {
        targetKey.classList.add('active');
        setTimeout(() => targetKey.classList.remove('active'), 500);
      }
    }

    // Load a lesson by index (0-based)
    function loadLesson(lessonIndex) {
      currentLessonIndex = lessonIndex;
      const lesson = enhancedLessons[lessonIndex];

      // Initialize exerciseProgress entry
      if (!progressData.exerciseProgress[lesson.id]) {
        progressData.exerciseProgress[lesson.id] = [];
      }

      // Start from exercise 0 by default - user can navigate freely
      currentExerciseIndex = 0;

      loadExercise();
      updateNavigationButtons();
      populateLessonsGrid();
      updateProgressDisplay();
    }

    // Load the current exercise
    function loadExercise() {
      const lesson = enhancedLessons[currentLessonIndex];
      const exercise = lesson.exercises[currentExerciseIndex];

      document.getElementById('lesson-title').textContent =
        `Lesson ${lesson.id}: ${lesson.name} (${currentExerciseIndex + 1}/${lesson.exercises.length})`;

      document.getElementById('lesson-timestamp').textContent =
        `Target: ${lesson.target_wpm} WPM | Exercise ${currentExerciseIndex + 1} | ${new Date().toLocaleTimeString()}`;

      // Reset passage and typing input
      passageEl.textContent = exercise;
      resetLesson();
      highlightCurrentCharacter();
      typingInput.focus();
      updateNavigationButtons();
    }

    // Update navigation button states
    function updateNavigationButtons() {
      const lesson = enhancedLessons[currentLessonIndex];
      
      // Previous button - disabled if first exercise of first lesson
      prevBtn.disabled = currentLessonIndex === 0 && currentExerciseIndex === 0;
      
      // Next button - disabled if last exercise of last lesson  
      nextBtn.disabled = currentLessonIndex === enhancedLessons.length - 1 && 
                        currentExerciseIndex === lesson.exercises.length - 1;
    }

    // Show passage with character-level highlighting
    function highlightCurrentCharacter() {
      const typed = typingInput.value || '';
      const currentExercise = enhancedLessons[currentLessonIndex].exercises[currentExerciseIndex];
      let html = '';

      for (let i = 0; i < currentExercise.length; i++) {
        const ch = currentExercise[i];
        if (i < typed.length) {
          if (typed[i] === ch) {
            html += `<span style="background-color: #4ade80; color: #000;">${escapeHtml(ch)}</span>`;
          } else {
            html += `<span style="background-color: #ef4444; color: #fff;">${escapeHtml(ch)}</span>`;
          }
        } else if (i === typed.length) {
          html += `<span style="background-color: #3b82f6; color: #fff; animation: pulse 1s infinite;">${escapeHtml(ch)}</span>`;
        } else {
          html += escapeHtml(ch);
        }
      }

      passageEl.innerHTML = html;
    }

    // Escape HTML for safe rendering
    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // Update stats live
    function updateStats() {
      const typed = typingInput.value;
      const currentExercise = enhancedLessons[currentLessonIndex].exercises[currentExerciseIndex];
      if (!startTime) return;

      // accuracy
      let correct = 0;
      for (let i = 0; i < typed.length; i++) {
        if (typed[i] === currentExercise[i]) correct++;
      }
      const accuracy = typed.length > 0 ? Math.round((correct / typed.length) * 100) : 100;
      document.getElementById('stat-acc').textContent = accuracy + '%';

      // WPM
      const timeElapsedMinutes = (new Date() - startTime) / 1000 / 60;
      const wordsTyped = correct / 5;
      const wpm = timeElapsedMinutes > 0 ? Math.round(wordsTyped / timeElapsedMinutes) : 0;
      document.getElementById('stat-wpm').textContent = wpm;
    }

    // Complete exercise
    // Complete exercise
    function completeExercise(isTimeUp = false) {
      clearInterval(timerInterval);
      typingInput.disabled = true;

      const timeElapsed = (new Date() - startTime) / 1000;
      const typed = typingInput.value;
      let correct = 0;
      const currentExercise = enhancedLessons[currentLessonIndex].exercises[currentExerciseIndex];
      for (let i = 0; i < typed.length; i++) {
        if (typed[i] === currentExercise[i]) correct++;
      }
      const accuracy = typed.length > 0 ? Math.round((correct / typed.length) * 100) : 100;
      const wpm = timeElapsed > 0 ? Math.round((correct / 5) / (timeElapsed / 60)) : 0;

      const lesson = enhancedLessons[currentLessonIndex];
      const passed = wpm >= lesson.target_wpm && accuracy >= 90 && !isTimeUp;

      // Show results immediately
      showExerciseResults(wpm, accuracy, passed, timeElapsed, isTimeUp);
      
      if (passed) {
        saveExerciseProgress(lesson.id, currentExerciseIndex, wpm, accuracy, timeElapsed);
        // Auto-advance to next exercise after short delay
        setTimeout(() => {
          if (currentExerciseIndex < lesson.exercises.length - 1) {
            currentExerciseIndex++;
            loadExercise();
          } else {
            // finished all exercises in this lesson
            completeLessonFully();
          }
        }, 1500);
      } else {
        // allow retry
        setTimeout(() => {
          typingInput.disabled = false;
          resetLesson();
          highlightCurrentCharacter();
          typingInput.focus();
        }, 2000);
      }
    }

    // Show results alert
    function showExerciseResults(wpm, accuracy, passed, time) {
      const lesson = enhancedLessons[currentLessonIndex];
      const exerciseNum = currentExerciseIndex + 1;
      const total = lesson.exercises.length;

      if (passed) {
        alert(`Exercise ${exerciseNum}/${total} Complete!\n\nWPM: ${wpm}\nAccuracy: ${accuracy}%\nTime: ${Math.round(time)}s\n\nAdvancing to next exercise...`);
      } else {
        alert(`Try Again!\nWPM: ${wpm} (need ‚â• ${lesson.target_wpm})\nAccuracy: ${accuracy}% (need ‚â• 90%)\n\nRestarting exercise...`);
      }
    }

    // Save exercise progress
    function saveExerciseProgress(lessonId, exerciseIndex, wpm, accuracy, time) {
      if (!progressData.exerciseProgress[lessonId]) {
        progressData.exerciseProgress[lessonId] = [];
      }
      if (!progressData.exerciseProgress[lessonId].includes(exerciseIndex)) {
        progressData.exerciseProgress[lessonId].push(exerciseIndex);
      }

      // Update lesson-level best if better
      if (!progressData.bestScores[lessonId] || wpm > progressData.bestScores[lessonId].wpm) {
        progressData.bestScores[lessonId] = { wpm, accuracy, time };
      }

      progressData.totalTime += time;
      localStorage.setItem('typingProgress', JSON.stringify(progressData));
      updateProgressDisplay();
      populateLessonsGrid();
    }

    // When full lesson completed
    function completeLessonFully() {
      const lesson = enhancedLessons[currentLessonIndex];
      const completed = progressData.exerciseProgress[lesson.id] || [];
      
      if (completed.length >= lesson.exercises.length && !progressData.completedLessons.includes(lesson.id)) {
        progressData.completedLessons.push(lesson.id);
        progressData.streak = (progressData.streak || 0) + 1;

        // unlock next lesson if exists
        const nextLesson = enhancedLessons[currentLessonIndex + 1];
        if (nextLesson && !progressData.unlockedLessons.includes(nextLesson.id)) {
          progressData.unlockedLessons.push(nextLesson.id);
        }

        localStorage.setItem('typingProgress', JSON.stringify(progressData));
        populateLessonsGrid();
        updateProgressDisplay();

        alert(`Congratulations! Lesson ${lesson.id} Fully Completed!\n\nYou've mastered all ${lesson.exercises.length} exercises!\n${nextLesson ? 'Next lesson unlocked!' : 'All lessons completed!'}`);
        
        // auto-load next lesson if unlocked
        if (nextLesson) {
          setTimeout(() => loadLesson(currentLessonIndex + 1), 2000);
        }
      }
    }

    // Reset current exercise/typing state
    function resetLesson() {
      typingInput.value = '';
      typingInput.disabled = false;
      timeLeft = 120;
      startTime = null;
      isTyping = false;

      document.getElementById('timer').textContent = '120s';
      document.getElementById('stat-wpm').textContent = '0';
      document.getElementById('stat-acc').textContent = '100%';

      clearInterval(timerInterval);
    }

    // Timer start
    function startTimer() {
      if (isTyping) return;
      isTyping = true;
      startTime = startTime || new Date();
      timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = timeLeft + 's';
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          typingInput.disabled = true;
          alert('Time\'s up! You can retry this exercise.');
          setTimeout(() => {
            resetLesson();
            highlightCurrentCharacter();
            typingInput.focus();
          }, 1000);
        }
      }, 1000);
    }

    // Typing input handlers
    typingInput.addEventListener('input', () => {
      if (!startTime) startTime = new Date();
      startTimer();

      highlightCurrentCharacter();
      updateStats();

      const current = enhancedLessons[currentLessonIndex].exercises[currentExerciseIndex];
      if (typingInput.value === current) {
        completeExercise();
      }
    });

    typingInput.addEventListener('blur', function() {
      setTimeout(() => {
        if (!typingInput.disabled) typingInput.focus();
      }, 100);
    });

    typingInput.addEventListener('paste', function(e) {
      e.preventDefault();
      alert('Pasting is not allowed. Please type manually to practice.');
    });

    // Prev/Next/Retry handlers
    prevBtn.addEventListener('click', () => {
      if (currentExerciseIndex > 0) {
        currentExerciseIndex--;
        loadExercise();
      } else if (currentLessonIndex > 0) {
        // Go to previous lesson's last exercise
        const prevLessonIndex = currentLessonIndex - 1;
        const prevLesson = enhancedLessons[prevLessonIndex];
        // Only go to previous lesson if it's unlocked
        if (progressData.unlockedLessons.includes(prevLesson.id)) {
          currentLessonIndex = prevLessonIndex;
          currentExerciseIndex = prevLesson.exercises.length - 1;
          loadExercise();
        }
      }
    });

    nextBtn.addEventListener('click', () => {
      const lesson = enhancedLessons[currentLessonIndex];
      if (currentExerciseIndex < lesson.exercises.length - 1) {
        currentExerciseIndex++;
        loadExercise();
      } else if (currentLessonIndex < enhancedLessons.length - 1) {
        // Go to next lesson's first exercise
        const nextLessonIndex = currentLessonIndex + 1;
        const nextLesson = enhancedLessons[nextLessonIndex];
        // Only go to next lesson if it's unlocked
        if (progressData.unlockedLessons.includes(nextLesson.id)) {
          currentLessonIndex = nextLessonIndex;
          currentExerciseIndex = 0;
          loadExercise();
        } else {
          alert('Complete all exercises in the current lesson to unlock the next lesson.');
        }
      }
    });

    retryBtn.addEventListener('click', () => {
      resetLesson();
      highlightCurrentCharacter();
      typingInput.focus();
    });

    // keyboard highlight on keydown
    document.addEventListener('keydown', (e) => {
      if (document.activeElement === typingInput && !typingInput.disabled) {
        highlightKey(e.code);
      }
    });

    // progress modal controls
    progressBtn.addEventListener('click', () => {
      updateProgressModal();
      progressModal.style.display = 'block';
    });

    closeProgress.addEventListener('click', () => {
      progressModal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
      if (e.target === progressModal) progressModal.style.display = 'none';
    });

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.section').forEach(section => section.classList.add('hidden'));
        const level = tab.getAttribute('data-level');
        document.getElementById(`section-${level}`).classList.remove('hidden');
      });
    });
    //Image Effect
   document.addEventListener("DOMContentLoaded", () => {
    const images = document.querySelectorAll("img");

    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
          observer.unobserve(entry.target); // fade only once
        }
      });
    }, { threshold: 0.2 }); // triggers when 20% of the image is visible

    images.forEach(img => observer.observe(img));
  });
    // Initial animations
    setTimeout(() => {
      document.querySelectorAll('.slide-up').forEach((el, index) => {
        setTimeout(() => el.style.animation = 'slideUp 0.5s ease forwards', index * 100);
      });
    }, 100);

    // Responsive keyboard
    function adjustKeyboardForMobile() {
      if (window.innerWidth < 768) {
        document.querySelectorAll('.key.space').forEach(key => {
          key.style.minWidth = '10rem';
        });
      } else {
        document.querySelectorAll('.key.space').forEach(key => {
          key.style.minWidth = '20rem';
        });
      }
    }
    window.addEventListener('resize', adjustKeyboardForMobile);
    adjustKeyboardForMobile();

    // Initialize
    function initializeApp() {
      // Ensure progress data has required structure
      if (!progressData.unlockedLessons || progressData.unlockedLessons.length === 0) {
        progressData.unlockedLessons = [1];
        localStorage.setItem('typingProgress', JSON.stringify(progressData));
      }

      populateLessonsGrid();
      updateProgressDisplay();

      // Load first unlocked lesson
      const firstUnlockedId = progressData.unlockedLessons[0];
      const idx = lessonIndexById(firstUnlockedId);
      loadLesson(idx >= 0 ? idx : 0);
      console.log('SoftFingers lessons initialized successfully.');
    }

    // Initialize the app
    initializeApp();
  </script>
</body>
</html>
